## Wat is nodig?

Om Active Directory te kunnen installeren moet aan enkele voorwaarden voldaan zijn. Eerst en vooral hebben we een "Windows Server"-installatie nodig. Elke editie vanaf Server 2003 en later is goed hiervoor. Daarnaast hebben we ook een NTFS-partitie met voldoende schijfruimte nodig. De reden hiervoor is dat ![](https://cdn.talentlms.com/it1education/1630388566_AD_requirements.png?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6XC9cL2Nkbi50YWxlbnRsbXMuY29tXC9pdDFlZHVjYXRpb25cLzE2MzAzODg1NjZfQURfcmVxdWlyZW1lbnRzLnBuZyIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTcxMTcxMzYwMH19fV19&Signature=iE6Moda-oo62iR6W9Tz0lDC-w0w1FHVnaJFaEiLF1giFvNNSVFUNS0IPVK%2Faa%2FJmaPe8-5KdepnJF%2FV2m-M%2FpoNd7a3bWXUbZ4RiC9I7D%2Ftvfaa6JrF-g3Ooxxco9DfLFYeAA1BB1XWjDp4KahpqOiL1WfM5MX-vGun0vlbLrMnJ30%2FZzl5pk6HYNISV%2FAzqorhDdrTJ1qXiSTcoFZL9nOBwPIXH7oFBO91WleSc16QOsAaqqyRrWpLqQZLw0PKmmqaxCyXG3q0y1LkzgH3eLN%2FU0cZWbCxMigDBJKePi1MGYN6%2FNhdQRuQHG%2FKaZIUBW3TtIVX9tjT3XyOh0oZu9A__&Key-Pair-Id=APKAJDCWVQTW4P3KI3XA)SYSVOL een dergelijke partitie vereist. De benodigde disk space zal natuurlijk afhangen van het aantal gebruikers, groepen en andere AD-objecten dat zal worden geïnstalleerd. Om enkel AD te installeren zonder extra objecten aan te maken is slechts 250 MB nodig, niet zo veel dus.

  

Een NIC (= Network Interface Card) die verbonden is met het netwerk en waaraan een statische IP-configuratie is toegewezen zorgt er dan weer voor dat de DNS-registraties correct werken. De AD Domain Controller moet immers verwijzen naar zijn eigen IP-adres in de DNS-serverlijst om mogelijke DNS-verbindingsproblemen te voorkomen. Als laatste moet gezegd dat enkel een lokale administrator (of iemand met dezelfde rechten) de installatie van Active Directory kan uitvoeren.

## Zomaar een DC verwijderen?

Als we Active Directory willen verwijderen is het geen goed idee om de Domain Controller gewoonweg te verwijderen uit het netwerk. We kunnen dit doen, maar dit zal problemen geven! Omdat er replicatie gebeurt met andere DC's binnen ons domein zullen er steeds verwijzingen naar die DC aanwezig blijven in de database NTDS. Deze zullen op (eerder korte dan lange) termijn altijd voor problemen zorgen aangezien de DC eigenlijk niet meer bestaat.

  

Hoe verwijderen we Active Directory dan best wel? Dit kunnen we op 2 manieren doen, via de GUI of via Powershell.

Als we dit via Powershell willen doen moeten we het volgende CMD-Let ingeven.

![](https://cdn.talentlms.com/it1education/1632031797_uninstall_ADDS_powershell.png?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6XC9cL2Nkbi50YWxlbnRsbXMuY29tXC9pdDFlZHVjYXRpb25cLzE2MzIwMzE3OTdfdW5pbnN0YWxsX0FERFNfcG93ZXJzaGVsbC5wbmciLCJDb25kaXRpb24iOnsiRGF0ZUxlc3NUaGFuIjp7IkFXUzpFcG9jaFRpbWUiOjE3MTE3MTM2MDB9fX1dfQ__&Signature=cDooX1e-fSEIlC%2Fi8z8X4g2YKGkY9xKqurioVmY2SIcRSCcIZp0ofYWhUEnw%2FsaVdvw%2FiFT5gTLgEhTcYBmwpyx1%2F0YMOeuKOPKLwHOQteZc-vtrt5MGrU-G9KR2fUsfLzqmwiRcDkCM7cmKQDKAghnyCQHGth7F5%2Fg%2F3IqOr6x9wzKf8YZim3QbyD0v4mqokDBtyVyt2ReVmKTc7Iz3wnrrIQqaxtimUZBKjEHVfFnzXtAhFeei3K-GNCqXwtBAj8TixLf%2FyCsQreFFzTFN8PxH-Zuc%2FOGUiQ136jtd1IbwhOMl8oSyT6osPrvcG58W1POC8vy0XjayCvaFkAXgPA__&Key-Pair-Id=APKAJDCWVQTW4P3KI3XA)

  

Willen we dit grafisch doen, dan maken we gebruik van "Remove roles and features" binnen de Server Manager. We doorlopen de volledige wizard en na een reboot zal de rol ADDS verwijderd zijn van de server waardoor dit geen Domain Controller meer is. Tijdens deze wizard zullen we echter op een probleem stuiten. Dit wordt besproken in het stuk 'Demote'.

Nadat ADDS volledig verwijderd is moeten we ook nog de rol 'DNS' verwijderen van de server indien we deze hadden meegeïnstalleerd. Indien deze op een andere server staat, dan verwijderen we daar die rol. Dit laatste doen we natuurlijk enkel indien er geen andere DC meer actief is binnen ons domein en DNS niet langer gewenst is binnen onze omgeving!

## Demote

![](https://cdn.talentlms.com/it1education/1632030580_remove_ADDS_demote.png?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6XC9cL2Nkbi50YWxlbnRsbXMuY29tXC9pdDFlZHVjYXRpb25cLzE2MzIwMzA1ODBfcmVtb3ZlX0FERFNfZGVtb3RlLnBuZyIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTcxMTcxMzYwMH19fV19&Signature=lJ4DPRSft1zbFkFrvvK0gf-fksAqqkcib%2Fn-hbBIGecrSwIpoELCwXCbE%2FGGldj3X97q0RPv88sQYSP%2Ff94W9dm-YOhqNRIrdHMeh5OMxwe%2Fncx%2FZBEIjDKNtzK7b6%2FX%2F09z8Gke11-kWqCSVsm0zyaI0B3-%2FlrQ96Vd%2F9YVhL6md9t69hFx2FentZV9uTuDC-4BAN64zy1w%2F1RcBPmOlPpGpS168MgWMFAGY14HzaCbNJWup5tgyy02zkf6ThC6z4jRg4OkW1%2FYK%2F0XsZMWAzqkRwxtozg1ALkBT%2FIjW9AGZEzw4gMFeBZ0JNEpQBIAt9rm4vBck0FDEROublS4Cw__&Key-Pair-Id=APKAJDCWVQTW4P3KI3XA)Om het replicatieprobleem te voorkomen moeten we een DC steeds eerst 'demoten'. Dit is eigenlijk het omgekeerde proces van 'promoten', wat we hebben gedaan bij het aanmaken van onze AD Domain Controller. Dit doen we tijdens het verwijderproces van de rol ADDS. Als we de rol willen verwijderen zal er een melding worden weergegeven dat dit niet zomaar kan en dat er eerst een 'demote' moet plaatsvinden alvorens de rol kan verwijderd worden. Via een nieuwe wizard die wordt geopend kunnen we dan dit 'demote'-proces afronden. Nadat dit voltooid is zal de rol ADDS, dus onze Active Directory, pas effectief verwijderd zijn van de server.

  

Tijdens het 'demoten' van de Domain Controller kunnen we verschillende opties kiezen om dit tot een goed einde te brengen. Zo kunnen we bvb. meegeven of het de laatste Domain Controller is of niet. We kunnen er ook voor kiezen om het verwijderproces te forceren. Dit houdt echter in dat we nadien onze omgeving nog moeten schoonmaken vanaf een andere DC in het domein (zie kader).

![](https://cdn.talentlms.com/it1education/1632032843_demote_wizard.png?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6XC9cL2Nkbi50YWxlbnRsbXMuY29tXC9pdDFlZHVjYXRpb25cLzE2MzIwMzI4NDNfZGVtb3RlX3dpemFyZC5wbmciLCJDb25kaXRpb24iOnsiRGF0ZUxlc3NUaGFuIjp7IkFXUzpFcG9jaFRpbWUiOjE3MTE3MTM2MDB9fX1dfQ__&Signature=J-XeovU4W2jfjaQoLvWsxTm8l8TnUEEAJSB2enYcxnLM9eIDEsR-1P5Fqn7Ci8%2FNXheR%2Fbb52xsLuAzotZ7KRu3nDsSq394RV6SryAko6r-1cb03vjjzT8-KMYbW7Qnh6xPr8COHsMPcLnC9xtorFWDJ8lovFShXvtAL81d7U9Zbxm9ujBLw-9epjjcLFGRmmpCz9RrkaM5RZkk3Em-bAcd42wgCFfq3oUZLl6TrPxmW3Y-VS3dRCa1PncC2XpvTGvcMizC%2FUdvhoxdEy6eSHpZWH8TD8FATesVYaK9wClnmLujWK-6w35tL93UPcnCn9Q8Wt0cJj6Md3vX4FxC6EA__&Key-Pair-Id=APKAJDCWVQTW4P3KI3XA)    ![](https://cdn.talentlms.com/it1education/1632032872_demote_wizard_2.png?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6XC9cL2Nkbi50YWxlbnRsbXMuY29tXC9pdDFlZHVjYXRpb25cLzE2MzIwMzI4NzJfZGVtb3RlX3dpemFyZF8yLnBuZyIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTcxMTcxMzYwMH19fV19&Signature=bGYFs2ajgvZz-sKmwG69tZ9WSI1Ww1XSUFZKqZFRFJudqQLDDqFp9b0AKCSddevGpW8svWUMoW9JAA%2F%2FdnRm-1jVpNmE8Og75eZFOVe4aqHu9QQCGgf9gWJjo9Mt-qn1RpCoLiE3mpQJDawZc50XLnZbff11FqEk9OAQAT8pi%2FOdy9w%2F%2Fv4ngm19PyfNYvnPpVhUvD8eabU4WZazztyk9r3a0AgZSEl7npI55S2JMeHyo1kr5AR2rR9xZERenDgpWn-vqlyF2TiQpcf33UZvUYsntReG9emiMqpea92BF9XMPD0JnvE95bYPYN9gOWRtENHb9BWUOrD5kttyjWccsw__&Key-Pair-Id=APKAJDCWVQTW4P3KI3XA)  

  

|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Als we wegens omstandigheden (bvb. falen van de hardware) een DC enkel maar geforceerd kunnen verwijderen uit ![](https://cdn.talentlms.com/it1education/1632034826_suru_uitroepteken.png?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6XC9cL2Nkbi50YWxlbnRsbXMuY29tXC9pdDFlZHVjYXRpb25cLzE2MzIwMzQ4MjZfc3VydV91aXRyb2VwdGVrZW4ucG5nIiwiQ29uZGl0aW9uIjp7IkRhdGVMZXNzVGhhbiI6eyJBV1M6RXBvY2hUaW1lIjoxNzExNzEzNjAwfX19XX0_&Signature=ebGsXr39-4BiPOFXkcTQpjOX1bpAijA%2FM8N8r3Cc6rpPKyu44L%2FKRe6pBI3InRV3UWJClZXHwXsbtgExD5xNrw2bnVKMqeORZw31%2FfZTP3rl4nQ%2FMgLO2BhF1G30iH9yhEnYC6gvK1pdgkSt4x81yg3-duwHBVgr-EYIeKPOoL37l8JORY-SJcNsUQSn46stA6lLWGPdD4mZFKvgOJdC5Rp-Yhwvy%2Fh7w--Omuj9P5oyEPG--%2FsFnKYjUat39Dynltv6CPEUdBO4R-yl9RTr6p%2F1XZG77iCUedtqM6NLl2mNrZU%2FQy5gQf-Q9lfVk8LfuIGG5FXN8LfiRZINF%2FFedw__&Key-Pair-Id=APKAJDCWVQTW4P3KI3XA)onze AD maar we hebben onze omgeving nog nodig, dan moeten we na het verwijderproces nog een Metadata Cleanup doen. Het is een vereiste procedure na een gedwongen verwijdering van een Domain Controller. We voeren het opschonen van metagegevens dan uit op een DC binnen het domein van de DC die we geforceerd hebben verwijderd. Met het proces Metadata Cleanup worden gegevens uit ADDS verwijderd die een Domain Controller identificeren voor het replicatiesysteem. Het opschonen van metagegevens verwijdert ook File Replication Service (FRS) en probeert alle FSMO-rollen over te dragen of over te nemen die de verwijderde DC had. |